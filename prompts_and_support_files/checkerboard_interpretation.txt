Each diagram in the book represents a checkers board state using a structured text format. Follow these steps precisely to extract the board information:

1. Diagram Structure
Diagram Label:
Each diagram starts with a label such as “Diagram N” or “Diagram N:”, where N is the diagram number. This may be followed by optional descriptive text.

Board Boundary:
The board representation begins with the top border line:
QRRRRRRRRS
and ends with the bottom border line:
VWWWWWWWWX
The border rows should be removed from the analysis.

Rows:
The board is composed of several rows. Each row is prefixed with a border token (either “T” or “U”), which should be replaced with spaces in the analysis.

Non-Playable Squares:
Non-playable (dark) squares are represented by the letter E. These should be replaced with spaces to make the tokenization and parsing easier.

2. Playable Squares and Square Numbering
Square Number Encoding:

Squares 1–9: Represented by digits “1” through “9”.

Squares 10–19: Represented with an exclamation mark as the leading symbol (e.g., !0 = 10, !1 = 11, …).

Squares 20–29: Represented with an at symbol as the leading symbol (e.g., @0 = 20, @1 = 21, …).

Squares 30–32: Represented with a hash symbol as the leading symbol (e.g., #0 = 30, #1 = 31, #2 = 32).

Empty Square:
A playable square with no piece is shown only by its square number (e.g., !5 or @3). No piece identifier is attached.

3. Piece Identification
Valid Piece Identifiers:

A: Black man

B: White man

C: Black king

D: White king

Rule for Identification:
A piece is only recognized if the piece identifier (A, B, C, or D) immediately precedes the square number with no intervening characters.
Examples:

C3 is valid and indicates a Black king on square 3. 

A!7 is valid and indicates a Black man on square !7 (i.e. square 17).

B@3 is valid and indicates a White man on square @3 (i.e. square 23).

4. Play Instruction
After the board representation, a single line will indicate which side is to move. This line starts with “Black to play”, “White to play”, or “Either to play”. This instruction must be extracted separately from the board.

5. Extraction Process Summary
Step 1: Locate the diagram by its label (“Diagram N” or “Diagram N:”).

Step 2: Extract the board from QRRRRRRRRS to VWWWWWWWWX. Delete those top and bottom borders after extraction.

Step 3: For each row, replace any E, T or U characters with spaces.

Step 4: For each space-separated token in the row:

If a token is simply a square number (with its special encoding), mark that square as empty.

If a token begins with one of the valid letters (A, B, C, or D) immediately followed by the square number, record that piece on the corresponding square.

Step 5: Verify the count and placement of pieces by comparing with the visual structure of the board.

Step 6: Record the play instruction provided on the line immediately following the board.